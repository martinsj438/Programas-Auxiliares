  def('modal', function(){ instances.modal=[];var bodyTopPosition=0;expose.create=function(){return new this.Modal},expose.open=function(e,o,s,t,n){var i=this.create();return o&&i.setMode.apply(i,o.split(":").reverse()),s&&i.setStyle(s),t&&i.setEvents(t),i.setContent(e,!0),-1==document.body.className.indexOf("modal-open")&&(n?(bodyTopPosition=document.body.scrollTop||document.documentElement.scrollTop,$("body").addClass("googleCaptcha")):document.body.style.top="-"+(document.body.scrollTop||document.documentElement.scrollTop)+"px"),document.body.className+=" modal-open",i},expose.Modal=function(){this.buildStructure(),this.enableUIControl(),this.enableEscClose(),this.enableClickClose(),"function"==typeof crazyloadinit&&this.addScrollEvent(crazyloadinit),instances.modal.push(this),$(this.dom).parent().prepend('<svg width="70px" height="70px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="loading uil-ring"><rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect><defs><filter id="uil-ring-shadow" x="-100%" y="-100%" width="300%" height="300%"><feOffset result="offOut" in="SourceGraphic" dx="0" dy="0"></feOffset><feGaussianBlur result="blurOut" in="offOut" stdDeviation="0"></feGaussianBlur><feBlend in="SourceGraphic" in2="blurOut" mode="normal"></feBlend></filter></defs><path d="M10,50c0,0,0,0.5,0.1,1.4c0,0.5,0.1,1,0.2,1.7c0,0.3,0.1,0.7,0.1,1.1c0.1,0.4,0.1,0.8,0.2,1.2c0.2,0.8,0.3,1.8,0.5,2.8 c0.3,1,0.6,2.1,0.9,3.2c0.3,1.1,0.9,2.3,1.4,3.5c0.5,1.2,1.2,2.4,1.8,3.7c0.3,0.6,0.8,1.2,1.2,1.9c0.4,0.6,0.8,1.3,1.3,1.9 c1,1.2,1.9,2.6,3.1,3.7c2.2,2.5,5,4.7,7.9,6.7c3,2,6.5,3.4,10.1,4.6c3.6,1.1,7.5,1.5,11.2,1.6c4-0.1,7.7-0.6,11.3-1.6 c3.6-1.2,7-2.6,10-4.6c3-2,5.8-4.2,7.9-6.7c1.2-1.2,2.1-2.5,3.1-3.7c0.5-0.6,0.9-1.3,1.3-1.9c0.4-0.6,0.8-1.3,1.2-1.9 c0.6-1.3,1.3-2.5,1.8-3.7c0.5-1.2,1-2.4,1.4-3.5c0.3-1.1,0.6-2.2,0.9-3.2c0.2-1,0.4-1.9,0.5-2.8c0.1-0.4,0.1-0.8,0.2-1.2 c0-0.4,0.1-0.7,0.1-1.1c0.1-0.7,0.1-1.2,0.2-1.7C90,50.5,90,50,90,50s0,0.5,0,1.4c0,0.5,0,1,0,1.7c0,0.3,0,0.7,0,1.1 c0,0.4-0.1,0.8-0.1,1.2c-0.1,0.9-0.2,1.8-0.4,2.8c-0.2,1-0.5,2.1-0.7,3.3c-0.3,1.2-0.8,2.4-1.2,3.7c-0.2,0.7-0.5,1.3-0.8,1.9 c-0.3,0.7-0.6,1.3-0.9,2c-0.3,0.7-0.7,1.3-1.1,2c-0.4,0.7-0.7,1.4-1.2,2c-1,1.3-1.9,2.7-3.1,4c-2.2,2.7-5,5-8.1,7.1 c-0.8,0.5-1.6,1-2.4,1.5c-0.8,0.5-1.7,0.9-2.6,1.3L66,87.7l-1.4,0.5c-0.9,0.3-1.8,0.7-2.8,1c-3.8,1.1-7.9,1.7-11.8,1.8L47,90.8 c-1,0-2-0.2-3-0.3l-1.5-0.2l-0.7-0.1L41.1,90c-1-0.3-1.9-0.5-2.9-0.7c-0.9-0.3-1.9-0.7-2.8-1L34,87.7l-1.3-0.6 c-0.9-0.4-1.8-0.8-2.6-1.3c-0.8-0.5-1.6-1-2.4-1.5c-3.1-2.1-5.9-4.5-8.1-7.1c-1.2-1.2-2.1-2.7-3.1-4c-0.5-0.6-0.8-1.4-1.2-2 c-0.4-0.7-0.8-1.3-1.1-2c-0.3-0.7-0.6-1.3-0.9-2c-0.3-0.7-0.6-1.3-0.8-1.9c-0.4-1.3-0.9-2.5-1.2-3.7c-0.3-1.2-0.5-2.3-0.7-3.3 c-0.2-1-0.3-2-0.4-2.8c-0.1-0.4-0.1-0.8-0.1-1.2c0-0.4,0-0.7,0-1.1c0-0.7,0-1.2,0-1.7C10,50.5,10,50,10,50z" filter="url(#uil-ring-shadow)"></path></svg>')},expose.Modal.prototype={mode:"normal",upmode:"",fx:{name:"fade",speed:200},visible:!1,onshow:function(){},onbeforeshow:function(){},onhide:function(){},onclose:function(e){if(e&&e.category){var o=e&&this.audienceObject(e);o&&hitAudience.countClick(o)}},audienceObject:function(e,o){return o=o||"","click"==e.type&&-1!=e.target.className.indexOf("icon-close")?o="fechar-modal-login":"click"==e.type&&-1!=e.target.className.indexOf("no-load")?o="fechar-clique-fora":"keyup"==e.type&&-1!=e.target.className.indexOf("modal-open")&&(o="fechar-esc-keyup"),e={reference:o,category:"login-"+e.category,action:"clique"}},onbeforeclose:function(){$("body").hasClass("googleCaptcha")&&(document.body.style.top=-1*bodyTopPosition+"px",$("body").removeClass("googleCaptcha"),$("body").removeClass("modal-open"))},visible_:!1,esc_:!1,click_:!1,queue_:[],setMode:function(e,o,s){s?this.fx.name=s:e&&(this.fx.name=e),e&&(this.closure.className+=" modal-mode-"+(this.mode=e)),void 0!==o&&(this.upmode&&(document.body.className=document.body.className.replace(" modal-"+this.upmode,"")),this.upmode=o,document.body.className+=" modal-"+this.upmode)},setEvents:function(e){for(var o in e)this[o]=e[o]},setStyle:function(e){$(this.dom).css(e)},setContent:function(e,o){if(!0===o&&(o=this.show),e instanceof jQuery&&(e=e.get(0)),e instanceof Node&&(e=e.outerHTML),"object"==typeof e){var s=null!=(Config||{}).servicename?Config.servicename:"/service/",t=(e.path||s)+"?json&loadComponent="+e.type+"&data="+encodeURIComponent(JSON.stringify(e.args))+"&configPath="+e.configPath;this.setMode(null,e.type),def.prototype.getjson.call(this,t,function(e){this.dom.innerHTML=e.body,o&&o.call(this),render()})}else-1==e.indexOf("\n")&&/^(https?:)?\/+[a-z0-9]|\..{2,4}$/.test(e)?def.prototype.getjson.call(this,e,function(e){this.dom.innerHTML=e.body,o&&o.call(this),render()}):(this.dom.innerHTML=e,o&&o.call(this),render())},show:function(e){if(this.visible=!0,this.closure.className=this.closure.className.replace(/\s+hide/,""),0==this.onbeforeshow())return!1;var o=this;"left"==this.fx.name?$(this.dom).animate({left:"0"},"normal",function(){e&&e.call(o),o.onshow(),render(),$(o.closure).addClass("no-load")}):"fade"==this.fx.name?$(this.dom).hide().fadeIn(this.fx.speed,function(){e&&e.call(o),o.onshow(),render(),$(o.closure).addClass("no-load")}):(e&&e.call(o),this.onshow(),$(o.closure).addClass("no-load"))},hide:function(e){this.visible=!1;var o=this;"left"==this.fx.name?($(this.closure).fadeOut(),$(this.dom).animate({left:"-100%"},"normal",function(){o.closure.className+=" hide",e&&e.call(o),o.onhide()})):"fade"==this.fx.name?$(this.dom).show().fadeOut(this.fx.speed,function(){o.closure.className+=" hide",e&&e.call(o),o.onhide()}):(this.closure.className+=" hide",e&&e.call(this),this.onhide()),this.upmode&&(document.body.className=document.body.className.replace(" modal-"+this.upmode,""));e:{for(var s=instances.modal.length;s--;)if(instances.modal[s].visible)break e;var t=Math.abs(parseInt(document.body.style.top));document.body.className=document.body.className.replace(/\smodal-open/g,""),document.body.removeAttribute("style"),window.scrollTo(0,t)}},enableUIControl:function(){var e=this;$(this.closure).on("click",".modal-close",function(o){o.preventDefault(),e.close(o);var s=$("head meta[name=viewport]"),t=s.attr("content");s.remove(),$("head").prepend('<meta name="viewport" content="'+t+'" />')})},enableEscClose:function(){this.esc_=!0},disableEscClose:function(){this.esc_=!1},enableClickClose:function(){this.click_=!0},disableClickClose:function(){this.click_=!1},addButtonClose:function(e){$(this.dom).prepend('<button class="btn modal-close" data-audience-click=\'{"reference":"fechar-modal-login","component":"'+e+'"}\'><i class="icon-close-2"></i></button>')},addHeader:function(e,o){var s="",t=this.dom;"object"==typeof e?(s=e.html,t=e.closure?this.closure:t):(e&&(s+="<h4>"+e+"</h4>"),o&&(s+='<p class="node"><small>'+o+"</small></p>")),s='<div class="modal-header">'+s+"</div>",$(".modal-header",this.dom).remove(),"BUTTON"==(this.dom.firstElementChild||{}).nodeName?$(this.dom.firstElementChild).after(s):$(t).prepend(s)},addScrollEvent:function(e){var o=this;$(this.dom).on("scroll",function(){e.apply(o,arguments)})},standalone:function(){for(var e=instances.modal.length;e--;){var o=instances.modal[e];o!==this&&(o.visible_=o.visible,o.visible&&o.hide(),this.queue_.push(instances.modal.splice(e,1)[0]))}},close:function(e){if(!1!==this.onbeforeclose()){e&&document.getElementsByClassName("modal-mode-babel-login").length&&(e.category=document.getElementsByClassName("modal-mode-babel-login")[0].dataset.category);for(var o=instances.modal.length;o--&&instances.modal[o]!==this;);if(-1!=o){for(var s=instances.modal.length;--s>o;)instances.modal.splice(s,1)[0].close();instances.modal.splice(o,1)}this.hide(function(){if(this.closure.parentNode.removeChild(this.closure),this.close=function(){},this.onclose(e),this.queue_.length){for(var o=this.queue_.length;o--;)this.queue_[o].visible_&&this.queue_[o].show();instances.modal=this.queue_}})}},buildStructure:function(){this.closure=document.createElement("div"),this.closure.className="modal",this.dom=document.createElement("div"),this.dom.className="modal-wrapper",this.closure.appendChild(this.dom),document.body.appendChild(this.closure)},unique:function(){for(var e=instances.modal.length;e--;)instances.modal[e]!==this&&instances.modal[e].close()}},window.addEventListener("keyup",function(e){switch(e.which||e.keyCode){case 27:var o=instances.modal&&instances.modal.slice(-1)[0];o&&o.esc_&&o.close(e)}}),window.addEventListener("click",function(e){var o=instances.modal&&instances.modal.slice(-1)[0];if(o&&o.click_){for(var s=window.SVGElementInstance&&e.target instanceof SVGElementInstance?e.target.correspondingUseElement:e.target;s&&("object"==typeof s.className||!s.className||-1==s.className.indexOf("modal-wrapper")&&-1==s.className.indexOf("loginbox"));)s=s.parentNode;s||o.close(e)}document.querySelector(".wrapper-header")&&document.querySelector(".wrapper-header").classList.remove("positioning")},!0); });    def('babel', function(){ "use strict";function like(e){action.call(this,"like",e)}function dislike(e){action.call(this,"dislike",e)}function action(e,i){return e?i?void lib["babel-login"].login().then(function(o){o.token&&lib["babel-service"].get({type:"message",service:e,id:i,params:{token:o.token}}).then(function(e){if(e.error)return alert(e.error),!1})}):(console.log("Informe o ID do comentário."),!1):(console.error("Informe o tipo da ação (like/dislike)."),!1)}expose.like=like,expose.dislike=dislike; });    def('babel-login', function(){ def("babel-login",["widget-profile","babel-service","babel","modal"],function(){"use strict";var e="babel.user.",o={opener:".babel-login, .pill.not-logged",modal:".modal",user:"#loginUser",password:"#loginPassword",login:"#login",logout:".logout, .pill.logged",message:"label.error",social:".login .loginWith a",changeView:".login .backToLogin a"};function t(){return!!widgetProfile&&widgetProfile.Login.isUserLoggedIn()}function n(){var o=this,t="object"==typeof widgetProfile&&widgetProfile.Settings.getAuth();events.emit(e+"login.success",null,["Usuário checado",t]),o.checkStatus().then(function(o){200==+o.code&&o.result&&o.result.user?5!=o.result.user.userStatus&&7!=o.result.user.userStatus||events.emit(e+"needNickname",null,["Usuário necessita um apelido"]):events.emit(e+"login.checked",null,["Usuário checado",o])},function(){setTimeout(function(){n.call(o)},1e3)})}function i(){var e,o=this,t=$.Deferred();return(e={product:"noticias",source:"UOL",auto_import:!0},console.debug("checkLogin ",e),lib["babel-service"].get({type:"user",service:"login",params:e||{}})).then(function(e){e&&"code"in e&&(200==+e.code||401==+e.code||428==+e.code)&&"result"in e&&"isLogged"in e.result?(o.session=e.result,o.session.code=+e.code,200===o.session.code&&o.session.isLogged&&o.persist(),t.resolve(o.session)):t.reject({type:"error",msg:"Houve um problema na autenticação do usuário. Tente novamente."})}),t.promise()}function s(o){o="function"==typeof o?o:function(){};var t=this;widgetProfile&&widgetProfile.Login.doLogout(!1,function(){t.session=!1;try{instances.header[0].showItens(0)}catch(e){console.error("[widget-profile] A função instances.header[0].showItens() não existe!")}events.emit(e+"logout.success",null,"Deslogado com sucesso!"),document.querySelector(".header, .bbolp-2014").querySelector("#uol-mail-link").querySelector(".mail-notification").innerHTML="",o()})}function r(){clearTimeout(window.persistence)}function l(e){var o="",t=e.separator||"&";return e.separator&&delete e.separator,jQuery.each(e,function(e,n){o+=(o.length?t:"")+encodeURIComponent(e)+"="+encodeURIComponent(n)}),o}function a(e){if("boolean"==typeof e.isLogged&&localStorage.getItem("porteira-login")){var o=e.isLogged?"login-success":"login-failure",t=JSON.parse(localStorage.getItem("porteira-login"));localStorage.removeItem("porteira-login"),e={category:t.component,reference:t.network,action:o},"undefined"!=t.component&&hitAudience.countEvent(e)}else if("string"==typeof e){let o=document.getElementsByClassName("modal-wrapper")[0].dataset.category;localStorage.setItem("porteira-login",JSON.stringify({network:e,component:o}))}}expose.session=!1;var c={fields:o.user+","+o.password+","+o.login,inputs:o.user+","+o.password,enabled:function(e){$(c.fields).attr("disabled",!e)},hasFocus:function(){$(this).closest("label")["focusin"==event.type||"focus"==event.type?"addClass":"removeClass"]("focus")},changeView:function(e){e.preventDefault(),$(".login .modal-body").toggleClass("alternative")}},u={login:function(e){var o={network:{facebook:{sn:1,source:"FACEBOOK"},twitter:{sn:5,source:"TWITTER"}}[(e=$.extend(!0,{type:"login",network:"facebook"},e)).network].sn,type:e.type,url:location.protocol+"//"+location.host+'/service/?loadComponent=babel-login&data={"closeWindow":true}'};a(e.network),c.enabled(!1);var t=window.open("","socialLogin",l({separator:",",width:600,height:600,scrolling:"no",statusbar:"no",resizeable:"no"}));lib["babel-service"].get({type:"user",service:"socialStart",params:{sn:o.network,social_auth_type:o.type,url_callback:o.url}}).then(function(e){var n={separator:"&",sn:o.network,"x-uol-social-tk":e.result.socialtoken};t.location.href="https://social.api.uol.com.br/oauth?"+l(n)})},select:function(e){e.preventDefault(),u.login({network:$(this).text().trim().toLowerCase()})},attempts:0,callback:function(e){var o=lib["babel-login"];if(e.success){var t=function(){i.call(o).then(function(e){!e.isLogged&&u.attempts<=1?(u.attempts++,setTimeout(t,1e3)):(u.attempts=0,g.instance&&g.newWindow&&g.close&&g.close(),events.emit("babel.user.login.success",null,["Logado com sucesso!",g]),o.loginRegister({isLogged:e.isLogged}))},function(){setTimeout(function(){u.callback.call(null,e)},1e3)})};setTimeout(t,100)}else d.error("Ocorreu um erro na autenticação por Rede Social. Tente novamente mais tarde!"),o.loginRegister({isLogged:!1})}},g={template:null,instance:null,newWindow:!0,getTemplate:function(e,o){if(g.template)g.template=g.template.replace(/(:"login)(-\w+)*/gi,"$1-"+o),e();else{var t={type:"babel-login",args:{page:window.location.href.replace(/#.*/,""),category:o}},n=new XMLHttpRequest;n.open("GET","/service/?loadComponent="+t.type+"&data="+encodeURIComponent(JSON.stringify(t.args))),n.onload=function(){g.template=n.responseText,e()},n.send()}},open:function(o){o.preventDefault();var n=o.currentTarget.dataset.category||"undefined",i=$.Deferred(),s={action:"open"};if("undefined"!=n&&(s.metrics={category:n}),console.debug("BABEL OPEN",n),widgetCustom[n]){let e=window.widgetCustom[n]||{};s.loginStyle={hideOutdoor:!1,title:e.titulo,subtitle:e.texto}}401===lib["babel-login"].session.code&&lib["babel-login"].isLogged()||428===lib["babel-login"].session.code?lib["babel-login"].logout(function(){widgetProfile.View.widgetModal(s,function(){console.debug("OPEN to login! - modal.open",n)})}):widgetProfile.View.widgetModal(s,function(){console.debug("OPEN to login! - modal.open",n)});var r=o.data&&o.data.instance||{};if(!!t.apply(r)){var l=$(this).data("config")||{};events.emit(e+"logged",null,["Usuário logado!",l])}return i.promise()},close:function(){g.instance.close&&g.instance.close()}},d={login:function(o){var t=o.data.instance;t.loginRegister("uol"),t.session=!1,t.login().then(function(o){o.type&&"error"==o.type?(d.error(o.msg),t.loginRegister({isLogged:"error"!=o.type})):(console.debug("self.login else",o),t.loginRegister({isLogged:!0}),events.emit(e+"login.success",null,["Logado com sucesso!",g]))})},logout:function(o){var t=o.data.instance;s.call(t),t.unpersist(),events.emit(e+"logout.success",null,"Deslogado com sucesso!"),"object"==typeof widgetProfile&&widgetProfile.reloadWidget()},error:function(o){$(".login .form").addClass("hasError").find(".error").text(o).removeClass("hidden").end().find("input").filter(function(){return""==this.value}).first().focus(),c.enabled(!0),a({islogged:!1}),events.emit(e+"login.fail",null,o)}};$("body").on("close",o.modal,g.close).on("click",o.opener,{instance:expose},g.open).on("click",o.login,{instance:expose},d.login).on("click",o.logout,{instance:expose},d.logout).on("click",o.social,u.select).on("click",o.changeView,c.changeView).on("focusin focusout",c.inputs,c.hasFocus),expose.login=function(){var e=$.Deferred();return this.isLogged()?(events.emit("babel.user.login.success",null,["Logado com sucesso!",g]),e.resolve(this.session)):function e(){var t=this,n=$.Deferred(),i=$(o.user).val(),s=$(o.password).val();if($(o.message).html(""),console.debug("doLogin"),!i||!s){var r=i?"Informe a senha.":"Informe o usuário.";return n.resolve({type:"error",msg:r})}return $.ajaxFrame({url:lib["babel-service"].routes.url.auth,data:{user:i,pass:s},callback:function(){t.checkStatus().then(function(e){n.resolve(e.isLogged?e:{type:"error",msg:"Email ou senha informados estão incorretos."})},function(){setTimeout(function(){e.call(t)},1e3)})}}),n.promise()}.call(this)},expose.logout=s,expose.modalLogin=g.open,expose.isLogged=t,expose.socialLogin=u.login,expose.whereAmI=function(){return lib["babel-service"].get({type:"user",service:"socialSimpleWhereAmI"})},expose.setSession=n,expose.checkStatus=i,expose.persist=function e(){var o;r(),(o={type:"user",service:"ping",params:{token:lib["babel-login"].session.token}},lib["babel-service"].get(o)).then(function(o){o.error||"pong"!==o.result.ping||(window.persistence=setTimeout(function(){e()},9e5))})},expose.unpersist=r,expose.loginRegister=a,window.callbackSocialLogin=u.callback,window.onfocus=function(e){var o=lib["babel-login"];if(e.currentTarget===window&&o){var t=o.isLogged(),i=function(){for(var e=document.cookie.split(";"),o=0;o<e.length;o++){for(var t=e[o];" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf("CAUBR01="))return t.substring("CAUBR01=".length,t.length)}return"eos"}();(!t&&"eos"!=i||t&&"eos"==i)&&n.call(o)}},jQuery.ajaxFrame=function(e){var o,t,n;e=jQuery.extend({data:{},dataType:"post",callback:jQuery.noop},e);var i="ajax-frame-"+(new Date).getTime(),s=jQuery('<iframe scrolling="no" frameborder="0" name="'+i+'"></iframe>');for(n in o='<form action="'+e.url+'" method="'+e.dataType+'" target="'+i+'">',e.data)e.data.hasOwnProperty(n)&&(o+='<input type="hidden" name="'+n+'" value="'+e.data[n]+'"/>');o+="</form>",t=jQuery(o),s.hide().appendTo("body"),t.appendTo("body").hide(),window.setTimeout(function(){s.load(function(){window.setTimeout(function(){s.remove()},500),t.remove(),e.callback.apply(this,arguments)}),t.submit()},500)}}); });    def('babel-service', function(){ def("babel-service",["/exposejs/jsonp-promise"],function(){"use strict";var e="https://n.comentarios.uol.com.br/",o={url:{auth:"https://acesso.uol.com.br/login.html?skin=comentarios&dest=REDIR|"+location.protocol+"//www3.uol.com.br/interacao/comentarios/blank.htm"},messages:{subject:"v1/messages/subject/{id}",editor:"v1/messages/editor-recommended/{id}",likesBySubject:"v1/users/likes-by-subject/{id}",parent:"parent/{id}"},subject:{retrieve:"ws/v1/subject/retrieve/{id}",simpleRetrieve:"ws/v1/subject/simple-retrieve/"},user:{login:"ws/v2/user/login",logout:"ws/v1/user/logout",create:"ws/v2/user/create",update:"ws/v2/user/update",ping:"ws/v1/user/ping",updateNotification:"ws/v1/user/update/reply-notification",updateNotificationType:"ws/v1/user/update/reply-notification-type",socialStart:"ws/v1/user/social/start-session",socialSimpleWhereAmI:"ws/v1/user/social/simple-where-am-i",socialWhereAmI:"ws/v1/user/social/where-am-i"},message:{create:"ws/v2/message/create",preview:"ws/v1/message/preview",del:"ws/v1/message/delete/{id}",edit:"ws/v2/message/edit/{id}",createSubject:"ws/v2/message/create/subject",pin:"ws/v1/message/pin/{id}/{id}",unpin:"ws/v1/messager/unpin/{id}",like:"ws/v1/message/like/{id}",dislike:"ws/v1/message/dislike/{id}"}};expose.get=function(s){var a;if(a={user:e,message:e,messages:"https://view.comentarios.uol.com.br/",subject:"https://view.comentarios.uol.com.br/"}[s.type]+function(e){return o[e.type][e.service].replace(/{id}/,e.id)}(s),s.params){var i;for(i in s.params)s.params.hasOwnProperty(i)&&"sort"!==i&&(s.params[i]=encodeURIComponent(s.params[i]));a+="?"+$.param(s.params)}return lib["jsonp-promise"]&&lib["jsonp-promise"].jsonp(a,s.service).error(function(e){var o="Ocorreu uma falha na requisição de dados.",a=s.root&&s.root.dom||!1;a?events.emit("babel.service.feedback",a,o):events.emit("babel.service.feedback",null,o)})},expose.routes=o,expose.messageHandler=function(e){if(!e)return console.log("Sem param"),!1;var o={api:{423:"Assunto inativo",425:"Usuário não encontrado",426:"Assunto não encontrado",427:"Mensagem não encontrada",428:"Você já avaliou esta mensagem",431:"Token de autenticação inválido",432:"Proteção antiflood",433:"Json inválido",434:"Critério de avaliação inválido",435:"Critério de avaliação não encontrado",436:"Usuário não tem permissão",440:"Falha na autenticação",444:"Tema não encontrado",446:"Falha na autorização",451:"Turing inválido",458:"Avaliação e comentários obrigatórios",500:"Operação não realizada, verifique os dados*"},friendlyMessage:{200:{message:{create:"Seu comentário foi enviado com sucesso.",del:"Seu comentário foi removido com sucesso.",preview:"",edit:"",createSubject:"",pin:"",unpin:"",like:"",dislike:""}},423:"Esta discussão foi encerrada",425:"Usuário não encontrado",426:"Assunto não encontrado",427:"Mensagem não encontrada",428:"Você já avaliou esta mensagem",431:"Token de autenticação inválido",432:"Ops!\n Aguarde alguns instantes antes de publicar seu novo comentário",433:"Json inválido",434:"Critério de avaliação inválido",435:"Critério de avaliação não encontrado",436:"Usuário não tem permissão",440:"Tempo para responder foi excedido.\n Por favor, faça novamente o login.",444:"Tema não encontrado",446:"Falha na autorização",451:"Turing inválido",458:"Avaliação e comentários obrigatórios",500:"Operação não realizada, verifique os dados*"},events:{200:"babel:success",400:"babel:invalid-parameter",422:"babel:subject:invalid-size",431:"babel:user:nickname",423:"babel:subject:close",432:"babel:user:anti-flood",436:"babel:user:not-allowed",440:"babel:session-expired"}},s={},a="Seu comentário foi enviado com sucesso.",i=+e.data.code,r=e.data.callback||jQuery.noop;if(!i)throw"Erro na API";200===i?(s=e.data.result,o.friendlyMessage[i][e.type]&&(a=o.friendlyMessage[i][e.type][e.service]),+s.pending_messages&&+s.user_pending_messages&&(a={badword_disapproved:"Seu comentário contém URL ou palavras de abuso. \nEscreva novamente seu comentário em <var>15</var> segundos",pending:"Seu comentário foi enviado com sucesso para moderação. \nHá "+s.pending_messages+" "+(1==s.pending_messages?"comentário":"comentários")+" na fila de moderação. "+s.user_pending_messages+" "+(1==s.user_pending_messages?"foi enviado":"foram enviados")+" por você."}[s.moderation_status.toLowerCase()],"badword_disapproved"==s.moderation_status.toLowerCase()&&(i=432))):a=o.friendlyMessage[i][e.type]?o.friendlyMessage[i][e.type][e.service]:o.friendlyMessage[i];var n={msg:a,code:i,callback:r};return e.root.dom?(n.button=e.button,events.emit("babel.service.feedback",e.root.dom,n)):events.emit("babel.service.feedback",null,n),a}}); });    def('comments', function(){ def("comments",function(){"use strict";include("angular","babel","teaser","modal","/exposejs/jsonp-promise");var e=e||{};$("body").on("click",".open-comments",function(){var e=$(this);if("string"==typeof(t=e.data("config")||!1))var t=JSON.parse(t.replace(/\'/g,'"'));if(!t||!t.id)return console.log("Não há dados de configuração setados neste botão"),!1;e.removeAttr("data-config");var i={type:"comments",args:$.extend({},t)};i.args.hasOwnProperty("modalOpen")&&(i.args.modalOpen=":"+i.args.modalOpen);var n=lib.modal.open(i,i.type+(i.args.modalOpen||""));n.onshow=function(){$(".babel-login",this.closure).data("modalOpen",t.modalOpen)},n.onbeforeshow=function(){var e=$(".comments:first",this.closure),i=e.data("config"),o=$.extend(!0,{},i,t);e.data("config",o),n.addButtonClose("login-comments"),render.call(this)},n.onclose=function(){}}),expose.init=function(){var t=angular.module("comentario",[]).filter("html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),i=this;this.$dom=$(this.dom),window.socialSimpleWhereAmI=window.socialSimpleWhereAmI||"";i.$dom.hasClass("display-inline");var n,o=this.$dom.data("initial-size");this.babel=lib.babel,this.babelLogin=lib["babel-login"],this.babelService=lib["babel-service"],t.constant("config",(n=i.$dom.data("config")||{},i.$dom.removeAttr("data-config"),n)),t.value("docs",[]),t.value("tabFilter",{type:"all",size:o||5,sort:"created:desc"}),t.run(function(){events.push("babel.service.feedback",i.$dom,function(e){var t=e.split?e:e.msg,n=e.code||0,o=e.callback||null,r=(t=t.split("\n")).length,s=t[0],a="";if(r>1){for(var c=1;c<r;c++)a+=(1==c?"<p>":"<br/>")+t[c];a+="</p>"}var l,u='<div class="row alert alert-'+(200===n?"success":"danger")+'"><h3>'+s+"</h3>"+a+'<a class="alert-close"><i class="icon-close-2"></i></a></div>',d=null==e.button?i.$dom.find(".feedback-service"):i.$dom.find(e.button).parents(".comment-reply").find(".feedback-service"),f=d.offset().top,m=d.parent();function g(e){d.css("height",0).parent().css("height","auto"),window.setTimeout(function(){d.removeClass("show").html("")},300),e&&e.call&&e.call(this),closingAlert&&window.clearTimeout(closingAlert)}m.css("height",m.outerHeight()),window.scrollY>f&&window.scrollTo(0,d.offset().top),d.html(u).addClass("show"),l=d.find(".alert").outerHeight(),d.add(m).css("height",l).find(".alert").addClass("show"),d.find(".alert-close").bind("click",function(){g(o)}),window.closingAlert=window.setTimeout(function(){d.find(".alert").length&&g(o)},3e4)}),$(".feedback-service").ajaxError(function(e,t,n){events.emit("babel.service.feedback",i.$dom,"Error requesting page "+n.url)})}),t.filter("brDate",[function(){return function(e){return e.trim().replace(/^(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})$/,"$3/$2/$1 $4:$5:$6")}}]),t.filter("prettyDate",[function(){return function(e){var t=new Date((e||"").replace(/-/g,"/").replace(/[TZ]/g," ")),i=((new Date).getTime()-($(window).data("server-date-diff")||0)-t.getTime())/1e3,n=Math.floor(i/86400);if(!(isNaN(n)||n<0)){var o=Math.ceil(n/7);return 0===n&&((i<60?"agora":i<120&&"1 minuto")||i<3600&&Math.floor(i/60)+" minutos atrás"||i<7200&&"1 hora atrás"||i<86400&&Math.floor(i/3600)+" horas atrás")||1==n&&"ontem"||n<7&&n+" dias atrás"||7==n&&"1 semana atrás"||o<=5&&Math.ceil(n/7)+" semanas atrás"||o>5&&e.replace(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}).*/g,"$3/$2/$1 $4h$5")}}}]),t.filter("formatDate",[function(){return function(e){return e.trim().replace(/^(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})$/,"$1-$2-$3T$4:$5:$6Z")}}]),t.filter("inversedDate",[function(){return function(e){if(!(e instanceof Date))return!1;function t(e){return(e<10?"0":"")+e}return e.getFullYear()+t(e.getMonth())+t(e.getDate())+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())}}]),t.filter("htmlentities",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),t.directive("ngImgonerror",function(){return{restrict:"A",link:function(e,t,i){t.bind("error",function(){$(this).attr("src","https://imguol.com/c/_layout/v2/components/comments/avatar.png").attr("title","O avatar não foi encontrado!").parent().addClass("img-error")})}}}),t.directive("ngHasTeaser",function(){return{restrict:"A",link:function(e,t,n){var o=t.find("textarea"),r=t.find(".teaser"),s=n.ngHasTeaser||960;i.teaser.create({dom:t,input:o,output:r,invert:!0,limit:s})}}}),t.directive("ngHasFocus",function(){return{restrict:"A",link:function(e,t,i){$(t).closest("label")["focusin"==event.type||"focus"==event.type?"addClass":"removeClass"]("focus")}}}),t.directive("ngAutoHeight",function(){return{restrict:"A",link:function(e,t,i){t.on("keyup",function(){var e=$(this),t=e.val(),i=e.css("max-height"),n=i.replace(/(\d+).*/,"$1");e.next().is(".resize")||e.after('<div class="resize"/>');var o=e.next(".resize");t=t.replace(/\n/g,"<br/>"),o.html(t+'<br class="lbr" />'),i.length&&e.css("overflow",o.height()>=n?"auto":"hidden"),e.css("height",o.height())}).on("keydown",function(){if($(this).hasClass("babel-login"))return!1}).on("focus",function(e){$(this).hasClass("babel-login")&&(e.preventDefault(),$(this).blur())}).on("focus",function(e){$("head meta[name=viewport]").remove(),$("head").prepend('<meta name="viewport" content="initial-scale=1.0, width=device-width, maximum-scale=1.0, user-scalable=no" />')}).focusout(function(){$("head meta[name=viewport]").remove(),$("head").prepend('<meta name="viewport" content="initial-scale=1.0, width=device-width, maximum-scale=10.0, user-scalable=yes" />')})}}}),t.service("Rating",function(){this.get=function(e){var t=e?$(e).first():i.$dom.find(".comment-post").first(),n=t.find(".rating").find(".rating-star").length,o=t.find(".rating").attr("data-rating");return!(!n||!o)&&o/n*100},this.reset=function(e){var t=e?$(e).first():i.$dom.find(".comment-post").first();t.find(".rating").find(".rating-star").removeClass("on"),t.find(".rating").attr("data-rating","0")},this.set=function(e){for(var t=[],i=1;i<=5;i++)t.push(parseInt(+e/20)>=i);return t}}),t.factory("User",[function(){var e,t={},n="https://imguol.com/c/_layout/v2/components/comments/avatar.png",o="Usuário não logado";return{get:function(e){return e?e in t&&t[e]:t},set:function(r,s,a){e=i.babelLogin.session,r&&r in e&&(e[r]=s),t.isLogged=e.user&&!0,t.uniqueId=e.user&&e.user.uniqueId,t.loggedWithFacebook=e.user&&"facebook"===e.user.socialNetwork.toLowerCase(),t.loggedWithTwitter=e.user&&"twitter"===e.user.socialNetwork.toLowerCase(),t.loggedWithUol=e.user&&"uol"===e.user.socialNetwork.toLowerCase(),"facebook"===window.socialSimpleWhereAmI?(t.loggedWithTwitter=!1,t.loggedWithFacebook=!0):"twitter"===window.socialSimpleWhereAmI&&(t.loggedWithTwitter=!0,t.loggedWithFacebook=!1),t.replyNotification=e.user&&e.user.replyNotification,t.avatarUrl=(e.user&&e.user.avatarUrl||n).replace("http:","https:"),t.alternativeText=e.user&&e.user.username||o},getSession:function(){return e},setSession:function(){return i.babelLogin.setSession()}}}]),t.factory("Likes",["$filter","User","config",function(e,t,n){var o={};return{getFromUser:function(e){var r=$.Deferred(),s=t.get("isLogged",Object.keys(o));return!s||Object.keys(o).length?(s||(o={}),r.resolve(!0)):(i.babelService.get({type:"messages",root:{dom:i.$dom},service:"likesBySubject",id:n.id}).then(function(e){return o=e.docs||{},r.resolve(!0)}),r.promise())},apply:function(e){return e in o},it:function n(r,s,a,c){t.get("isLogged")?(i.babel[s](r.id),c||(r.like++,r.likedByMe=!0,o[r.id]=e("inversedDate")(new Date))):(r.like++,r.likedByMe=!0,o[r.id]=e("inversedDate")(new Date),a.data={instance:expose},i.babelLogin.modalLogin(a).done(function(){window.setTimeout(function(){t.set(),n(r,s,a,!0)},4e3)}))}}}]),t.service("Action",["Subject","User","Likes","Rating","config",function(e,t,n,o,r){var s=[];function a(){var e=$.Deferred();return s.length?e.resolve(s):i.babelLogin.whereAmI().then(function(t){if(200==+t.code)for(var i in t.result){var n=t.result[i];s.push(n.snname)}e.resolve(s)}),e.promise()}this.create=function(){var e=this,n=t.getSession(),s=(e.newText||"").trim(),c=o.get();if(!c&&!s.length)return events.emit("babel.service.feedback",i.$dom,"Avaliação ou comentário obrigatórios."),!1;a().then(function(t){var a=t.join(",").toUpperCase()||"",l={type:"message",root:{dom:i.$dom},service:"create",params:{subject:r.id,token:n.token,product:"noticias",source:"UOL"}};if(""!==s&&(l.params.message=s),c&&(l.params.rating='{"344": "'+c+'"}'),a.length){("FACEBOOK"===a?i.$dom.find('input[id^="share-fb"]').is(":checked"):i.$dom.find('input[id^="share-tt"]').is(":checked"))&&(l.params.social_networks=a)}i.babelService.get(l).then(function(t){if(l.data=t,i.babelService.messageHandler(l),200==+t.code){o.reset(),e.newText="",e.refresh();hitAudience.countEvent({reference:"escrever-comentario",action:"logged-user-success",component:"login-comments"})}})})},this.shareComment=function(e){("facebook"==e||"twitter"==e)&&a().then(function(t){-1==t.indexOf(e)&&i.babelLogin.socialLogin({type:"auth",root:{dom:i.$dom},network:e,callback:"socialAuthentication"})})},this.replyNotification=function(){var e=this,n=t.getSession(),o=this.replyByEmail||!1,r={type:"user",service:"updateNotification",root:{dom:i.$dom},params:{reply_notification:o,token:n.token,product:"noticias",source:"UOL"}};i.babelService.get(r).then(function(n){r.data=n,200!=+n.code?i.babelService.messageHandler(r):(t.set("user",n.result),e.refresh())})},this.del=function(e,n){var o=this,r=n||e,s=t.getSession(),a={type:"message",root:{dom:i.$dom},service:"del",id:r.id,params:{token:s.token}};i.babelService.get(a).then(function(t){if(a.data=t,i.babelService.messageHandler(a),200==+t.code){if(r.del=!0,n)e.reply_count>0&&e.reply_count--;o.refresh()}})},this.reply=function(e,n){var o=this,s=n.currentTarget,a=t.getSession(),c=e.replyText[e.id],l={type:"message",service:"create",button:s,root:{dom:i.$dom},params:{subject:r.id,parent:e.id,message:c,token:a.token}};i.babelService.get(l).then(function(t){l.data=t,i.babelService.messageHandler(l),200==+t.code&&(e.replyText[e.id]="",e.replyit=!0,setTimeout(function(){e.replyit=!1,o.refresh()},5e3))})},this.like=function(e,t){return n.it(e,"like",t)},this.logout=function(){$(".comment-fadOut").fadeOut(function(){i.babelLogin.logout()})},this.dislike=function(e){return n.it(e,"dislike")}}]),t.factory("Subject",["config","tabFilter",function(e,t){if(e.id){var n={comments:{},subject:{}},o=function(t){return i.babelService.get({type:"messages",root:{dom:i.$dom},service:t.service,id:e.id,params:t.params})};return{get:function(e){return n.subject[e]||n.subject},load:function(r){var s=$.Deferred();function a(){o(r).then(function(e){return n.comments="docs"in e?e:void 0,s.resolve({data:n})})}return(r=angular.extend({params:{}},r)).service="subject",r.next&&(r.params.next=r.next),r.prev&&(r.params.prev=r.prev),t.type=r.type||"all",r.params.size=t.size,r.size&&(r.params.size=r.size),"like"===r.type&&(t.sort=r.params.sort),"all"!=r.type&&(r.params.sort="like:desc,created:desc"),"editor"===r.type&&(r.service="editor"),Object.keys(n.subject).length?a():function(t){return i.babelService.get({type:"subject",service:"retrieve",root:{dom:i.$dom},id:e.id,params:t.params})}(r).then(function(i){if(200!=+i.code)return s.resolve({hasError:!0,result:i});if(!r.type&&i.result){var o=e.likes&&+e.likes||1,c={like:function(){+i.result.highestMessageLikes>=o&&(t.type="like",r.params.sort="like:desc,created:desc")},editor:function(){i.result.hasEditorRecommendation&&(t.type="editor",r.service="editor")}};(e.sequence&&e.sequence.split(",")||[]).reverse().forEach(function(e){c[e]&&c[e]()})}n.subject=i,a()}),s.promise()}}}}]),t.controller("CommentsController",["$scope","Subject","User","Action","Rating","Likes","config","docs","tabFilter",function(t,n,o,r,s,a,c,l,u){var d=this;o.setSession(),t.btnSizeReplies=function(){return"xs"==lib.breakpoints.breakpoint.name?"btn-small":"btn-medium"},d.changeTab=function(e){u.type!=e&&(l=[],u.type=e,d.load({type:e}))},d.getMore=function(e){hitAudience.countClick({component:"comments",reference:"ver-mais-comentarios"});var n=i.$dom.find(".comment").last();if(c["display-inline"])n.offset().top,n.outerHeight();else n.position().top,n.outerHeight();i.$dom.children().first().append('<div class="overlay" />'),d.load({type:u.type,id:c.subjectId,size:t.nextsize,next:d.next}),setTimeout(function(){i.$dom.find(".overlay").remove()},100),d.refresh()},d.filter=function(){var e=o.get("isLogged"),t=o.get("uniqueId");function i(i){return i.hasReplies=+i.reply_count,i.commentedWithFB="facebook"===i.social_network.toLowerCase(),i.commentedWithTT="twitter"===i.social_network.toLowerCase(),i.has_rating&&(i.rating=s.set(i.rating_average)),e&&(i.isMyMessage=i.unique_user_id===t),i.likedByMe=a.apply(i.id),i}return l.filter(function(e){i(e),e.replies.filter(function(e){i(e)})}),l},d.firstComment=function(){null==o.get("isLogged")&&!c["display-inline"]&&c["first-comment"]&&window.setTimeout(function(){$(".modal .comments .babel-login:visible").trigger("click")},300)},d.openReplies=function(e){if(e.hasReplies&&!e.replies){var t=o.getSession(),r=n.get("result"),s={type:"messages",service:"parent",root:{dom:i.$dom},id:e.id,params:{size:20,repository:r.repository,token:t.token}};i.babelService.get(s).then(function(e){angular.forEach(d.docs,function(t,i){if(t.id==coment.id)return t.replies.push(e.docs),!1}),d.docs=d.filter()})}e.repliesOpened=!e.repliesOpened},d.getReplies=function(e){if(e.hasReplies>3){if(e.replies.length>3)var r=t.nextsizereplies;else r=t.nextsizereplies+3;e.nextReplies||(e.nextReplies="");var s=o.getSession(),a=n.get("result"),c={type:"messages",service:"parent",root:{dom:i.$dom},id:e.id,params:{size:r,repository:a.repository,next:e.nextReplies,token:s.token}};i.babelService.get(c).then(function(t){angular.forEach(d.docs,function(i,n){if(i.id==e.id)return e.nextReplies||t.docs.splice(0,3),e.nextReplies=t.next,angular.forEach(t.docs,function(e,t){i.replies.push(e)}),!1}),d.refresh()}),hitAudience.countClick({component:"comments",reference:"ver-mais-respostas"})}},d.del=r.del,d.reply=r.reply,d.logout=r.logout,d.create=r.create,d.replyNotification=r.replyNotification,d.shareComment=function(e){return window.socialSimpleWhereAmI=e,d.refresh(),r.shareComment(e)},d.like=function(e,t){return d.refresh(),a.it(e,"like",t)},d.dislike=function(e){return a.it(e,"dislike")},d.load=function(e){i.$dom.attr("data-loaded","true"),n.load(e).then(function(e){var i=e.data;if(e.hasError)d.hasError=!0;else{if(i.subject&&i.subject.result){d.subject=i.subject;var n=d.subject.result,o=+n.total;n.hasRating&&(o+=+n.totalRatings+ +n.totalCommentsWithRatings),n.replies&&(o+=+n.replies),d.isClosed=n.isClosed,d.info=n,d.total=o,d.title=d.title||d.info.description}if(i.comments){for(var r=i.comments.docs.length,s=0;s<r;s++)i.comments.docs[s].avatar=i.comments.docs[s].avatar.replace("http://","//");l=l.concat(i.comments.docs),d.docs=d.filter(),d.tabActive=u.type,d.next=i.comments.next,d.prev=i.comments.prev}}d.isVisible=!0,t.$apply(),render()})},d.whereAmI=function(){i.babelLogin.whereAmI().then(function(e){if(200==+e.code){for(var t in e.result){var i=e.result[t];window.socialSimpleWhereAmI=i.snname}d.refresh()}})},d.refresh=function(){o.set(),t.user=o.get(),t.user.isLogged||(d.newText=""),d.docs=d.filter(),t.$$phase||t.$apply()},d.isDebug=c.debug||!1,d.title=c.title||e.mediaTitle||"",d.subtitle=c.subtitle||"",events.push("babel.user.logged",null,function(e,t){d.refresh(),console.log("logged",e,t)}),events.push("babel.user.login.checked",null,function(e,t){""===window.socialSimpleWhereAmI&&(window.socialSimpleWhereAmI="Request Realizado!",d.whereAmI()),d.refresh(),console.log("login.checked",e)}),events.push("babel.user.login.success",null,function(e,t){c["display-inline"];d.refresh(),t.def&&t.def(),console.log("login.success",e)}),events.push("babel.user.login.fail",null,function(e){d.refresh(),console.log("login.fail",e)}),events.push("babel.user.needNickname",null,function(e){d.refresh(),console.log("needNickname",e)}),events.push("babel.user.logout.success",null,function(e){d.refresh(),console.log("logout.success",e)}),d.load()}]),angular.bootstrap(this.dom,["comentario"])}}); });  